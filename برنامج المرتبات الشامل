<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --success: #16a34a;
            --danger: #dc2626;
            --warning: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #94a3b8;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background-color: var(--primary);
            color: white;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px var(--shadow);
        }

        .btn.success {
            background-color: var(--success);
        }

        .btn.success:hover {
            background-color: #15803d;
        }

        .btn.danger {
            background-color: var(--danger);
        }

        .btn.danger:hover {
            background-color: #b91c1c;
        }

        .btn.light {
            background-color: var(--light);
            color: var(--dark);
            border: 1px solid var(--border);
        }

        .btn.light:hover {
            background-color: #e2e8f0;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            background-color: white;
            border: none;
            font-family: 'Tajawal', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }

        .tab:hover {
            background-color: var(--primary-light);
        }

        .tab.active {
            background-color: var(--primary);
            color: white;
        }

        .section {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px var(--shadow);
            margin-bottom: 20px;
        }

        .section.active {
            display: block;
        }

        .section h2 {
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.5rem;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid var(--border);
        }

        th {
            background-color: var(--primary-light);
            font-weight: 600;
            color: var(--primary-dark);
        }

        tr:hover {
            background-color: #f8fafc;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .actions a {
            color: var(--primary);
            text-decoration: none;
            font-size: 1.2rem;
        }

        .actions a:hover {
            color: var(--primary-dark);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 20px;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .alert.success {
            background-color: #dcfce7;
            color: var(--success);
            border: 1px solid #bbf7d0;
        }

        .alert.danger {
            background-color: #fee2e2;
            color: var(--danger);
            border: 1px solid #fecaca;
        }

        .hidden {
            display: none;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow);
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .stat-card p {
            color: var(--gray);
            margin: 0;
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-container input,
        .search-container select {
            flex: 1;
            min-width: 200px;
        }

        .payslip {
            max-width: 800px;
            margin: 20px auto;
            padding: 30px;
            border: 1px solid #ccc;
        }

        .payslip-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .payslip-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .payslip-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #ddd;
        }

        .payslip-total {
            font-weight: bold;
            font-size: 1.1rem;
            margin-top: 10px;
        }

        .signature-section {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
        }

        .activity-item {
            display: flex;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            font-size: 1.5rem;
            margin-left: 15px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .activity-time {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .theme-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .theme-option.active {
            border-color: var(--dark);
        }

        @media (max-width: 768px) {
            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .tab {
                min-width: 100px;
                padding: 12px 15px;
                font-size: 0.9rem;
            }

            .section {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 20px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .payslip-details {
                grid-template-columns: 1fr;
            }

            .search-container {
                flex-direction: column;
            }
        }

        .payroll-settings-container {
            display: flex;
            gap: 20px;
        }

        @media (max-width: 992px) {
            .payroll-settings-container {
                flex-direction: column;
            }
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        .salary-alert {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-screen" class="container">
        <div class="card" style="max-width: 400px; margin: 100px auto; padding: 30px;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input type="text" id="username" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            </div>
            <div class="form-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            <button class="btn" onclick="login()" style="width: 100%;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <div id="login-error" class="alert danger hidden" style="margin-top: 15px;"></div>
        </div>
    </div>

    <!-- Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ù…Ø®ÙÙŠ Ø­ØªÙ‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) -->
    <div id="main-system" class="container hidden">
        <div class="header">
            <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</h1>
            <div class="user-info">
                <span id="user-name"></span>
                <button class="btn light" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSection('dashboard')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="tab" onclick="showSection('employees')">Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†</button>
            <button class="tab" onclick="showSection('deductions')">Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª</button>
            <button class="tab" onclick="showSection('withdrawals')">Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª</button>
            <button class="tab" onclick="showSection('loans')">Ø§Ù„Ø³Ù„Ù</button>
            <button class="tab" onclick="showSection('payroll')">ÙƒØ´ÙˆÙ</button>
            <button class="tab" onclick="showSection('reports')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
            <button class="tab" onclick="showSection('settings')">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
        <div id="dashboard-section" class="section active">
            <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="total-employees">0</h3>
                    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-salaries">0</h3>
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-absences">0</h3>
                    <p>Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-penalties">0</h3>
                    <p>Ø§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-withdrawals">0</h3>
                    <p>Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</p>
                </div>
            </div>

            <h3>Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
            <div class="card" style="padding: 20px;">
                <div id="recent-activities">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                </div>
            </div>
        </div>

        <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
        <div id="employees-section" class="section">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
            <div class="search-container">
                <input type="text" id="employee-search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†..." oninput="filterEmployees()">
                <button class="btn" onclick="showAddEmployeeForm()">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</button>
            </div>
            <table>
                <tr>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th>
                    <th>Ø±Ø§ØªØ¨ Ø§Ù„ØªØ£Ù…ÙŠÙ†</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
                <tbody id="employees-table-body"></tbody>
            </table>
        </div>

        <!-- Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª -->
        <div id="deductions-section" class="section">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù</label>
                    <select id="deduction-employee">
                        <option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…</label>
                    <select id="deduction-type">
                        <option value="absence">ØºÙŠØ§Ø¨</option>
                        <option value="penalty">Ø¬Ø²Ø§Ø¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… (ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ³Ø±)</label>
                    <input type="number" id="deduction-days" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…" step="0.01">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="deduction-date">
                </div>
                <div class="form-group" style="grid-column: span 2;">
                    <label>Ø§Ù„Ø³Ø¨Ø¨</label>
                    <textarea id="deduction-reason" rows="2" placeholder="Ø³Ø¨Ø¨ Ø§Ù„ØºÙŠØ§Ø¨ Ø£Ùˆ Ø§Ù„Ø¬Ø²Ø§Ø¡"></textarea>
                </div>
            </div>
            <button class="btn" onclick="addDeduction()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®ØµÙ…</button>
            <div class="search-container" style="margin-top: 30px;">
                <input type="text" id="deduction-search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª..." oninput="filterDeductions()">
            </div>
            <h3 style="margin-top: 20px;">Ø³Ø¬Ù„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</h3>
            <table id="deductions-table">
                <tr>
                    <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                    <th>Ø§Ù„Ø£ÙŠØ§Ù…</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„Ø³Ø¨Ø¨</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
                <tbody id="deductions-table-body"></tbody>
            </table>
        </div>

        <!-- Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª -->
        <div id="withdrawals-section" class="section">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù</label>
                    <select id="withdrawal-employee">
                        <option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº</label>
                    <input type="number" id="withdrawal-amount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="withdrawal-date">
                </div>
                <div class="form-group" style="grid-column: span 2;">
                    <label>Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="withdrawal-desc" rows="2" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª"></textarea>
                </div>
            </div>
            <button class="btn" onclick="addWithdrawal()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª</button>
            
            <div class="search-container" style="margin-top: 30px;">
                <select id="withdrawal-search-employee" onchange="searchWithdrawals()">
                    <option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§</option>
                </select>
                <input type="month" id="withdrawal-search-month" onchange="searchWithdrawals()">
                <button class="btn light" onclick="searchWithdrawals()">Ø¨Ø­Ø«</button>
                <button class="btn success" onclick="exportWithdrawalsToExcel()">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
                <button class="btn" onclick="printWithdrawals()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>
            
            <h3 style="margin-top: 20px;">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª 
                <span id="total-withdrawal-amount" style="float: left; font-size: 1rem; color: var(--primary);"></span>
            </h3>
            <table id="withdrawals-table">
                <tr>
                    <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„ÙˆØµÙ</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
                <tbody id="withdrawals-table-body"></tbody>
            </table>
        </div>

        <!-- Ø§Ù„Ø³Ù„Ù -->
        <div id="loans-section" class="section">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ù</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù</label>
                    <select id="loan-employee">
                        <option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ</label>
                    <input type="number" id="loan-amount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ" step="0.01">
                </div>
                <div class="form-group">
                    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
                    <input type="number" id="loan-installment" placeholder="Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø·" step="0.01">
                </div>
                <div class="form-group">
                    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                    <input type="date" id="loan-start-date">
                </div>
                <div class="form-group" style="grid-column: span 2;">
                    <label>Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="loan-desc" rows="2" placeholder="ÙˆØµÙ Ø§Ù„Ø³Ù„ÙØ©"></textarea>
                </div>
            </div>
            <button class="btn" onclick="addLoan()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ù„ÙØ©</button>
            
            <h3 style="margin-top: 30px;">Ø³Ø¬Ù„ Ø§Ù„Ø³Ù„Ù</h3>
            <table>
                <tr>
                    <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ</th>
                    <th>Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</th>
                    <th>Ø§Ù„ÙˆØµÙ</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
                <tbody id="loans-table-body"></tbody>
            </table>
        </div>

        <!-- ÙƒØ´ÙˆÙ Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª -->
        <div id="payroll-section" class="section">
            <h2>ÙƒØ´ÙˆÙ Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù</label>
                    <select id="payroll-employee">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</label>
                    <input type="month" id="payroll-month">
                </div>
            </div>
            <button class="btn" onclick="generatePayroll()">ØªÙˆÙ„ÙŠØ¯ ÙƒØ´Ù Ø§Ù„Ø±Ø§ØªØ¨</button>
            <button class="btn success" onclick="printPayroll()" style="margin-right: 10px;">Ø·Ø¨Ø§Ø¹Ø© ÙƒØ´Ù Ø§Ù„Ø±Ø§ØªØ¨</button>
            <div id="payroll-container" class="payslip" style="margin-top: 30px; display: none;"></div>
        </div>

        <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
        <div id="reports-section" class="section">
            <h2>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                    <select id="report-type">
                        <option value="payroll">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±ÙˆØ§ØªØ¨</option>
                        <option value="absences">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª</option>
                        <option value="penalties">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª</option>
                        <option value="insurance">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª</option>
                        <option value="welfareFund">ØªÙ‚Ø±ÙŠØ± ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</label>
                    <input type="month" id="report-month">
                </div>
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</label>
                    <select id="report-department">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                        <option value="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                        <option value="Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª">Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</option>
                        <option value="Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>
                        <option value="Ø§Ù„Ù…Ø®Ø§Ø²Ù†">Ø§Ù„Ù…Ø®Ø§Ø²Ù†</option>
                        <option value="Ø§Ù„Ø­Ø±ÙƒØ© ">Ø§Ù„Ø­Ø±ÙƒØ©</option>
                        <option value="Ø§Ù„ØµÙŠØ§Ù†Ø©">Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="generateReport()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            <button class="btn success" onclick="exportReportToPDF()" style="margin-right: 10px;">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF</button>
            <button class="btn" onclick="exportReportToExcel()">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
            
            <div class="report-output" id="report-output" style="margin-top: 30px; display: none;">
                <h3 id="report-title"></h3>
                <div id="report-content"></div>
            </div>
        </div>

        <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div id="settings-section" class="section">
            <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            
            <div class="card" style="padding: 20px; margin-bottom: 20px;">
                <h3>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©</h3>
                <div class="form-group">
                    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø© (Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡)</label>
                    <input type="number" id="welfare-fund-amount" placeholder="Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ" min="0" step="0.01">
                </div>
                <button class="btn" onclick="updateWelfareFundSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                <div id="welfare-fund-result" class="alert hidden" style="margin-top: 10px;"></div>
            </div>
            
            <div class="card" style="padding: 20px; margin-bottom: 20px;">
                <h3>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                    <input type="password" id="current-password">
                </div>
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <input type="password" id="new-password">
                </div>
                <div class="form-group">
                    <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <input type="password" id="confirm-password">
                </div>
                <button class="btn" onclick="updatePassword()">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                <div id="password-change-result" class="alert hidden" style="margin-top: 10px;"></div>
            </div>
            
            <div class="card" style="padding: 20px; margin-bottom: 20px;">
                <h3>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©</h3>
                <p>Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ùˆ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù.</p>
                <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" onclick="downloadBackup()">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                    <input type="file" id="restore-file" accept=".json" style="display: none;" onchange="restoreBackup(event)">
                    <button class="btn light" onclick="document.getElementById('restore-file').click()">ğŸ“¤ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ù…Ù„Ù</button>
                    <button class="btn" onclick="syncWithGoogleSheet()">ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Google Sheet</button>
                </div>
                <div id="restore-result" class="alert hidden" style="margin-top: 10px;"></div>
            </div>
            
            <div class="card" style="padding: 20px; margin-bottom: 20px;">
                <h3>ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ù…Ø©</h3>
                <div class="theme-selector">
                    <div class="theme-option active" style="background-color: #2563eb;" onclick="changeTheme('#2563eb')"></div>
                    <div class="theme-option" style="background-color: #dc2626;" onclick="changeTheme('#dc2626')"></div>
                    <div class="theme-option" style="background-color: #16a34a;" onclick="changeTheme('#16a34a')"></div>
                    <div class="theme-option" style="background-color: #f59e0b;" onclick="changeTheme('#f59e0b')"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¸Ù -->
    <div id="add-employee-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="employee-modal-title">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="employee-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
                        <input type="number" id="employee-salary" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ø§ØªØ¨ Ø§Ù„ØªØ£Ù…ÙŠÙ†</label>
                        <input type="number" id="employee-insurance-salary" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§ØªØ¨ Ø§Ù„ØªØ£Ù…ÙŠÙ†" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù‚Ø³Ù…</label>
                        <select id="employee-department">
                            <option value="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                            <option value="Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª">Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</option>
                            <option value="Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>
                            <option value="Ø§Ù„Ù…Ø®Ø§Ø²Ù†">Ø§Ù„Ù…Ø®Ø§Ø²Ù†</option>
                            <option value="Ø§Ù„Ø­Ø±ÙƒØ© ">Ø§Ù„Ø­Ø±ÙƒØ©</option>
                            <option value="Ø§Ù„ØµÙŠØ§Ù†Ø©">Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØ¸ÙŠÙØ©</label>
                        <input type="text" id="employee-job-title" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                        <input type="text" id="employee-id" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„ØªØ£Ù…ÙŠÙ†</label>
                        <input type="text" id="employee-insurance-number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ£Ù…ÙŠÙ†">
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label>
                        <input type="date" id="employee-hire-date">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©</label>
                        <select id="employee-welfare-fund">
                            <option value="Ù†Ø¹Ù…">Ù†Ø¹Ù…</option>
                            <option value="Ù„Ø§">Ù„Ø§</option>
                        </select>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="save-employee-btn" onclick="saveEmployee()" class="btn">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù</button>
                    <button onclick="closeModal()" class="btn light">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨/Ø§Ù„Ø¬Ø²Ø§Ø¡ -->
    <div id="edit-deduction-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨/Ø§Ù„Ø¬Ø²Ø§Ø¡</h3>
                <button class="close-btn" onclick="closeEditDeductionModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-deduction-id">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Ø§Ù„Ù…ÙˆØ¸Ù</label>
                        <select id="edit-deduction-employee" disabled>
                            <option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…</label>
                        <select id="edit-deduction-type">
                            <option value="absence">ØºÙŠØ§Ø¨</option>
	                        <option value="penalty">Ø¬Ø²Ø§Ø¡</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… (ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ³Ø±)</label>
                        <input type="number" id="edit-deduction-days" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="edit-deduction-date">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Ø§Ù„Ø³Ø¨Ø¨</label>
                        <textarea id="edit-deduction-reason" rows="2" placeholder="Ø³Ø¨Ø¨ Ø§Ù„ØºÙŠØ§Ø¨ Ø£Ùˆ Ø§Ù„Ø¬Ø²Ø§Ø¡"></textarea>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button onclick="updateDeduction()" class="btn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®ØµÙ…</button>
                    <button onclick="closeEditDeductionModal()" class="btn light">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª -->
    <div id="edit-withdrawal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª</h3>
                <button class="close-btn" onclick="closeEditWithdrawalModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-withdrawal-id">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Ø§Ù„Ù…ÙˆØ¸Ù</label>
                        <select id="edit-withdrawal-employee" disabled>
                            <option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¨Ù„Øº</label>
                        <input type="number" id="edit-withdrawal-amount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="edit-withdrawal-date">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Ø§Ù„ÙˆØµÙ</label>
                        <textarea id="edit-withdrawal-desc" rows="2" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª"></textarea>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button onclick="updateWithdrawal()" class="btn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª</button>
                    <button onclick="closeEditWithdrawalModal()" class="btn light">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù„Ù -->
    <div id="edit-loan-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù„ÙØ©</h3>
                <button class="close-btn" onclick="closeEditLoanModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-loan-id">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Ø§Ù„Ù…ÙˆØ¸Ù</label>
                        <select id="edit-loan-employee" disabled>
                            <option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ</label>
                        <input type="number" id="edit-loan-amount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
                        <input type="number" id="edit-loan-installment" placeholder="Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø·" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                        <input type="date" id="edit-loan-start-date">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Ø§Ù„ÙˆØµÙ</label>
                        <textarea id="edit-loan-desc" rows="2" placeholder="ÙˆØµÙ Ø§Ù„Ø³Ù„ÙØ©"></textarea>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button onclick="updateLoan()" class="btn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù„ÙØ©</button>
                    <button onclick="closeEditLoanModal()" class="btn light">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        let employees = [];
        let deductions = [];
        let withdrawals = [];
        let loans = [];
        let activities = [];
        let currentUser = null;
        let editingEmployeeId = null;
        let welfareFundAmount = 0; // Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        const users = [
            { username: 'admin', password: '1234', name: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…' },
            { username: 'hr', password: 'hr123', name: 'Ù…ÙˆØ¸Ù Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©' }
        ];

        // Ø¹Ù†ÙˆØ§Ù† Google Apps Script Web App
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzBjbQkDHo-HrURXn3kftIyrUkFDxcaq0KkMbk1KPwsI3eFrcVwRLfzxJDph7HRCIW3/exec";
        const SPREADSHEET_ID = "1Zy7HNoe_jJrmz8lbHZw9uJLLGxDrQv5Xg0jV6zhKJd8";

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function initApp() {
            // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©
            loadData();
            populateEmployeeDropdowns();
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
            const today = new Date();
            document.getElementById('deduction-date').value = today.toISOString().split('T')[0];
            document.getElementById('withdrawal-date').value = today.toISOString().split('T')[0];
            document.getElementById('loan-start-date').value = today.toISOString().split('T')[0];
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
            const currentMonth = today.toISOString().slice(0, 7);
            document.getElementById('payroll-month').value = currentMonth;
            document.getElementById('report-month').value = currentMonth;
            document.getElementById('withdrawal-search-month').value = currentMonth;
            
            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            updateDashboard();
            
            // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©
            loadWelfareFundSettings();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            if (localStorage.getItem('currentUser')) {
                currentUser = JSON.parse(localStorage.getItem('currentUser'));
                showPayrollSystem();
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('login-error');
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                document.getElementById('login-screen').classList.add('hidden');
                showPayrollSystem();
            } else {
                errorDiv.textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                errorDiv.classList.remove('hidden');
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙˆØ§ØªØ¨
        function showPayrollSystem() {
            document.getElementById('main-system').classList.remove('hidden');
            document.getElementById('user-name').textContent = currentUser.name;
            updateDashboard();
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('main-system').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('login-error').classList.add('hidden');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† LocalStorage Ø£Ùˆ Google Sheet
        async function loadData() {
            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ù† Google Sheet Ø£ÙˆÙ„Ø§Ù‹
                const data = await fetchGoogleSheetData();
                if (data && data.employees) {
                    employees = data.employees || [];
                    deductions = data.deductions || [];
                    withdrawals = data.withdrawals || [];
                    loans = data.loans || [];
                    activities = data.activities || [];
                    welfareFundAmount = data.welfareFundAmount || 0;
                    console.log("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheet");
                } else {
                    // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Google SheetØŒ Ø§Ø³ØªØ®Ø¯Ù… LocalStorage
                    const savedData = localStorage.getItem('payrollSystemData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        employees = data.employees || [];
                        deductions = data.deductions || [];
                        withdrawals = data.withdrawals || [];
                        loans = data.loans || [];
                        activities = data.activities || [];
                        welfareFundAmount = data.welfareFundAmount || 0;
                    }
                    console.log("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† LocalStorage");
                }
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ø§Ø³ØªØ®Ø¯Ù… LocalStorage
                const savedData = localStorage.getItem('payrollSystemData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    employees = data.employees || [];
                    deductions = data.deductions || [];
                    withdrawals = data.withdrawals || [];
                    loans = data.loans || [];
                    activities = data.activities || [];
                    welfareFundAmount = data.welfareFundAmount || 0;
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            renderEmployeesTable();
            renderDeductionsTable();
            renderWithdrawalsTable();
            renderLoansTable();
            populateEmployeeDropdowns();
            updateDashboard();
            loadWelfareFundSettings();
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ LocalStorage ÙˆGoogle Sheet
        async function saveData() {
            const data = {
                employees,
                deductions,
                withdrawals,
                loans,
                activities,
                welfareFundAmount
            };
            
            // Ø­ÙØ¸ Ø¥Ù„Ù‰ LocalStorage
            localStorage.setItem('payrollSystemData', JSON.stringify(data));
            
            // Ø­ÙØ¸ Ø¥Ù„Ù‰ Google Sheet
            try {
                await saveToGoogleSheet(data);
                console.log("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheet");
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheet:", error);
            }
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheet
        async function fetchGoogleSheetData() {
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getAllData`);
                if (!response.ok) throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheet:", error);
                return null;
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheet
        async function saveToGoogleSheet(data) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'saveAllData',
                        data: data
                    })
                });
                
                if (!response.ok) throw new Error("ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                const result = await response.json();
                return result;
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheet:", error);
                throw error;
            }
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Google Sheet
        async function syncWithGoogleSheet() {
            const resultDiv = document.getElementById('restore-result');
            try {
                const data = await fetchGoogleSheetData();
                if (data && data.employees) {
                    employees = data.employees || [];
                    deductions = data.deductions || [];
                    withdrawals = data.withdrawals || [];
                    loans = data.loans || [];
                    activities = data.activities || [];
                    welfareFundAmount = data.welfareFundAmount || 0;
                    
                    saveData(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
                    updateDashboard();
                    renderEmployeesTable();
                    renderDeductionsTable();
                    renderWithdrawalsTable();
                    renderLoansTable();
                    populateEmployeeDropdowns();
                    loadWelfareFundSettings();
                    
                    resultDiv.textContent = 'ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Google Sheet Ø¨Ù†Ø¬Ø§Ø­';
                    resultDiv.className = 'alert success';
                } else {
                    resultDiv.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Google Sheet';
                    resultDiv.className = 'alert danger';
                }
            } catch (error) {
                resultDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message;
                resultDiv.className = 'alert danger';
            }
            resultDiv.classList.remove('hidden');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©
        function loadWelfareFundSettings() {
            const savedAmount = localStorage.getItem('welfareFundAmount');
            if (savedAmount) {
                welfareFundAmount = parseFloat(savedAmount);
                document.getElementById('welfare-fund-amount').value = welfareFundAmount;
            }
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©
        function updateWelfareFundSettings() {
            const amount = parseFloat(document.getElementById('welfare-fund-amount').value) || 0;
            welfareFundAmount = amount;
            localStorage.setItem('welfareFundAmount', amount);
            
            const resultDiv = document.getElementById('welfare-fund-result');
            resultDiv.textContent = 'ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­';
            resultDiv.className = 'alert success';
            resultDiv.classList.remove('hidden');
            
            // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
            addActivity(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø© Ø¥Ù„Ù‰ ${amount} Ø¬Ù†ÙŠÙ‡`);
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            saveData();
        }

        // ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function updatePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const resultDiv = document.getElementById('password-change-result');
            
            if (newPassword !== confirmPassword) {
                resultDiv.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ£ÙƒÙŠØ¯Ù‡Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†';
                resultDiv.className = 'alert danger';
                resultDiv.classList.remove('hidden');
                return;
            }
            
            if (currentUser.password !== currentPassword) {
                resultDiv.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                resultDiv.className = 'alert danger';
                resultDiv.classList.remove('hidden');
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            currentUser.password = newPassword;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            resultDiv.textContent = 'ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­';
            resultDiv.className = 'alert success';
            resultDiv.classList.remove('hidden');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        function downloadBackup() {
            const dataStr = "text/json;charset=utf-8," + encodeURIComponent(JSON.stringify({
                employees,
                deductions,
                withdrawals,
                loans,
                activities,
                welfareFundAmount
            }, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "backup_payroll_system.json");
            document.body.appendChild(downloadAnchorNode); // required for firefox
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
            addActivity(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©`);
        }

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        function restoreBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    employees = data.employees || [];
                    deductions = data.deductions || [];
                    withdrawals = data.withdrawals || [];
                    loans = data.loans || [];
                    activities = data.activities || [];
                    welfareFundAmount = data.welfareFundAmount || 0;
                    
                    saveData();
                    updateDashboard();
                    renderEmployeesTable();
                    renderDeductionsTable();
                    renderWithdrawalsTable();
                    renderLoansTable();
                    populateEmployeeDropdowns();
                    loadWelfareFundSettings();
                    
                    const resultDiv = document.getElementById('restore-result');
                    resultDiv.textContent = 'ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­';
                    resultDiv.className = 'alert success';
                    resultDiv.classList.remove('hidden');
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
                    addActivity(`ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©`);
                } catch (error) {
                    const resultDiv = document.getElementById('restore-result');
                    resultDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message;
                    resultDiv.className = 'alert danger';
                    resultDiv.classList.remove('hidden');
                }
            };
            reader.readAsText(file);
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ†
        function showSection(sectionName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(sectionName + '-section').classList.add('active');
            
            // Ø¬Ø¹Ù„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù†Ø´Ø·Ù‹Ø§
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                if (tab.textContent.includes(
                    sectionName === 'dashboard' ? 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' :
                    sectionName === 'employees' ? 'Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†' :
                    sectionName === 'deductions' ? 'Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª' :
                    sectionName === 'withdrawals' ? 'Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª' :
                    sectionName === 'loans' ? 'Ø§Ù„Ø³Ù„Ù' :
                    sectionName === 'reports' ? 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±' :
                    sectionName === 'payroll' ? 'ÙƒØ´ÙˆÙ' :
                    sectionName === 'settings' ? 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' : ''
                )) {
                    tab.classList.add('active');
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function updateDashboard() {
            document.getElementById('total-employees').textContent = employees.length;
            
            const totalSalaries = employees.reduce((sum, emp) => sum + emp.salary, 0);
            document.getElementById('total-salaries').textContent = totalSalaries.toLocaleString() + ' Ø¬Ù†ÙŠÙ‡';
            
            const now = new Date();
            const currentMonth = now.toISOString().slice(0, 7);
            
            const totalAbsences = deductions.filter(d => d.type === 'absence' && d.month === currentMonth).reduce((sum, d) => sum + d.days, 0);
            document.getElementById('total-absences').textContent = totalAbsences + ' ÙŠÙˆÙ…';
            
            const totalPenalties = deductions.filter(d => d.type === 'penalty' && d.month === currentMonth).reduce((sum, d) => sum + d.days, 0);
            document.getElementById('total-penalties').textContent = totalPenalties + ' ÙŠÙˆÙ…';
            
            const totalWithdrawals = withdrawals.filter(w => w.month === currentMonth).reduce((sum, w) => sum + w.amount, 0);
            document.getElementById('total-withdrawals').textContent = totalWithdrawals.toLocaleString() + ' Ø¬Ù†ÙŠÙ‡';
            
            renderActivities();
        }

        // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
        function addActivity(description) {
            const activity = {
                id: Date.now(),
                description: description,
                time: new Date().toLocaleString('ar-EG')
            };
            activities.unshift(activity); // Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            activities = activities.slice(0, 10); // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø£Ø­Ø¯Ø« 10 Ø£Ù†Ø´Ø·Ø©
            saveData();
            renderActivities(); // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù†Ø´Ø·Ø©
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù†Ø´Ø·Ø©
        function renderActivities() {
            const activitiesContainer = document.getElementById('recent-activities');
            if (!activitiesContainer) return;
            
            activitiesContainer.innerHTML = '';
            
            if (activities.length === 0) {
                activitiesContainer.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ø­Ø¯ÙŠØ«Ø©</p>';
                return;
            }
            
            activities.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';
                activityItem.innerHTML = `
                    <div class="activity-icon">ğŸ“‹</div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.description}</div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                `;
                activitiesContainer.appendChild(activityItem);
            });
        }

        // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function populateEmployeeDropdowns() {
            const employeeSelects = document.querySelectorAll('select[id$="-employee"]');
            employeeSelects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§</option>';
                employees.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = employee.name;
                    select.appendChild(option);
                });
                select.value = currentValue; // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
            });
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù„ÙƒØ´ÙˆÙ Ø§Ù„Ø±ÙˆØ§ØªØ¨
            const payrollEmployeeSelect = document.getElementById('payroll-employee');
            if (payrollEmployeeSelect) {
                const currentValue = payrollEmployeeSelect.value;
                payrollEmployeeSelect.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>';
                employees.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = employee.name;
                    payrollEmployeeSelect.appendChild(option);
                });
                payrollEmployeeSelect.value = currentValue;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
            const withdrawalSearchEmployeeSelect = document.getElementById('withdrawal-search-employee');
            if (withdrawalSearchEmployeeSelect) {
                const currentValue = withdrawalSearchEmployeeSelect.value;
                withdrawalSearchEmployeeSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§</option>';
                employees.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = employee.name;
                    withdrawalSearchEmployeeSelect.appendChild(option);
                });
                withdrawalSearchEmployeeSelect.value = currentValue;
            }
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function renderEmployeesTable() {
            const tableBody = document.getElementById('employees-table-body');
            tableBody.innerHTML = '';
            
            employees.forEach(employee => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.name}</td>
                    <td>${employee.salary.toLocaleString()} Ø¬Ù†ÙŠÙ‡</td>
                    <td>${employee.insuranceSalary.toLocaleString()} Ø¬Ù†ÙŠÙ‡</td>
                    <td>${employee.department}</td>
                    <td>${employee.jobTitle}</td>
                    <td>${employee.hireDate}</td>
                    <td class="actions">
                        <a href="#" onclick="editEmployee(${employee.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</a>
                        <a href="#" onclick="deleteEmployee(${employee.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</a>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù
        function saveEmployee() {
            const employee = {
                id: editingEmployeeId || Date.now(),
                name: document.getElementById('employee-name').value,
                salary: parseFloat(document.getElementById('employee-salary').value) || 0,
                insuranceSalary: parseFloat(document.getElementById('employee-insurance-salary').value) || 0,
                department: document.getElementById('employee-department').value,
                jobTitle: document.getElementById('employee-job-title').value,
                idNumber: document.getElementById('employee-id').value,
                insuranceNumber: document.getElementById('employee-insurance-number').value,
                hireDate: document.getElementById('employee-hire-date').value,
                welfareFundConsent: document.getElementById('employee-welfare-fund').value
            };
            
            if (!employee.name || !employee.salary) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            if (editingEmployeeId) {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
                const index = employees.findIndex(emp => emp.id === editingEmployeeId);
                if (index !== -1) {
                    employees[index] = employee;
                }
                addActivity(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù: ${employee.name}`);
            } else {
                // Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯
                employees.push(employee);
                addActivity(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯: ${employee.name}`);
            }
            
            saveData();
            renderEmployeesTable();
            populateEmployeeDropdowns();
            updateDashboard();
            closeModal();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('employee-name').value = '';
            document.getElementById('employee-salary').value = '';
            document.getElementById('employee-insurance-salary').value = '';
            document.getElementById('employee-job-title').value = '';
            document.getElementById('employee-id').value = '';
            document.getElementById('employee-insurance-number').value = '';
            editingEmployeeId = null;
            document.getElementById('employee-modal-title').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯';
            document.getElementById('save-employee-btn').textContent = 'Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù';
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¸Ù
        function editEmployee(employeeId) {
            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) return;
            
            editingEmployeeId = employeeId;
            document.getElementById('employee-modal-title').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù';
            document.getElementById('save-employee-btn').textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¸Ù';
            
            document.getElementById('employee-name').value = employee.name;
            document.getElementById('employee-salary').value = employee.salary;
            document.getElementById('employee-insurance-salary').value = employee.insuranceSalary;
            document.getElementById('employee-department').value = employee.department;
            document.getElementById('employee-job-title').value = employee.jobTitle;
            document.getElementById('employee-id').value = employee.idNumber;
            document.getElementById('employee-insurance-number').value = employee.insuranceNumber;
            document.getElementById('employee-hire-date').value = employee.hireDate;
            document.getElementById('employee-welfare-fund').value = employee.welfareFundConsent;
            
            document.getElementById('add-employee-modal').style.display = 'flex';
        }

        // Ø­Ø°Ù Ù…ÙˆØ¸Ù
        function deleteEmployee(employeeId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù ÙˆÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ØŸ')) {
                employees = employees.filter(emp => emp.id !== employeeId);
                
                // Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                deductions = deductions.filter(d => d.employeeId !== employeeId);
                withdrawals = withdrawals.filter(w => w.employeeId !== employeeId);
                loans = loans.filter(l => l.employeeId !== employeeId);
                
                saveData();
                renderEmployeesTable();
                renderDeductionsTable();
                renderWithdrawalsTable();
                renderLoansTable();
                populateEmployeeDropdowns();
                updateDashboard();
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
                addActivity(`ØªÙ… Ø­Ø°Ù Ù…ÙˆØ¸Ù`);
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function closeModal() {
            document.getElementById('add-employee-modal').style.display = 'none';
        }

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function filterEmployees() {
            const searchTerm = document.getElementById('employee-search').value.toLowerCase();
            const rows = document.querySelectorAll('#employees-table-body tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù
        function showAddEmployeeForm() {
            document.getElementById('add-employee-modal').style.display = 'flex';
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª
        function renderDeductionsTable() {
            const tableBody = document.getElementById('deductions-table-body');
            tableBody.innerHTML = '';
            
            deductions.forEach(deduction => {
                const employee = employees.find(emp => emp.id === deduction.employeeId);
                const employeeName = employee ? employee.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employeeName}</td>
                    <td>${deduction.type === 'absence' ? 'ØºÙŠØ§Ø¨' : 'Ø¬Ø²Ø§Ø¡'}</td>
                    <td>${deduction.days}</td>
                    <td>${deduction.date}</td>
                    <td>${deduction.reason}</td>
                    <td class="actions">
                        <a href="#" onclick="editDeduction(${deduction.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</a>
                        <a href="#" onclick="deleteDeduction(${deduction.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</a>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ…
        function addDeduction() {
            const employeeId = document.getElementById('deduction-employee').value;
            const type = document.getElementById('deduction-type').value;
            const days = parseFloat(document.getElementById('deduction-days').value);
            const date = document.getElementById('deduction-date').value;
            const reason = document.getElementById('deduction-reason').value;
            
            if (!employeeId || !days || !date) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            const deduction = {
                id: Date.now(),
                employeeId: parseInt(employeeId),
                type: type,
                days: days,
                date: date,
                month: date.substring(0, 7), // Ø­ÙØ¸ Ø§Ù„Ø´Ù‡Ø± Ù„Ù„ØªØµÙÙŠØ©
                reason: reason
            };
            
            deductions.push(deduction);
            saveData();
            renderDeductionsTable();
            updateDashboard();
            clearDeductionForm();
            
            // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
            const employee = employees.find(emp => emp.id === parseInt(employeeId));
            const deductionTypeText = type === 'absence' ? 'ØºÙŠØ§Ø¨' : 'Ø¬Ø²Ø§Ø¡';
            addActivity(`ØªØ³Ø¬ÙŠÙ„ ${deductionTypeText} Ù„Ù„Ù…ÙˆØ¸Ù ${employee ? employee.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`);
        }

        // Ù…Ø³Ø­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø®ØµÙ…
        function clearDeductionForm() {
            document.getElementById('deduction-employee').value = '';
            document.getElementById('deduction-type').value = 'absence';
            document.getElementById('deduction-days').value = '';
            document.getElementById('deduction-reason').value = '';
            // Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø®ØµÙ…
        function editDeduction(deductionId) {
            const deduction = deductions.find(d => d.id === deductionId);
            if (!deduction) return;
            
            document.getElementById('edit-deduction-id').value = deduction.id;
            document.getElementById('edit-deduction-employee').value = deduction.employeeId;
            document.getElementById('edit-deduction-type').value = deduction.type;
            document.getElementById('edit-deduction-days').value = deduction.days;
            document.getElementById('edit-deduction-date').value = deduction.date;
            document.getElementById('edit-deduction-reason').value = deduction.reason;
            
            // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const employeeSelect = document.getElementById('edit-deduction-employee');
            employeeSelect.innerHTML = '';
            employees.forEach(employee => {
                const option = document.createElement('option');
                option.value = employee.id;
                option.textContent = employee.name;
                employeeSelect.appendChild(option);
            });
            employeeSelect.value = deduction.employeeId;
            
            document.getElementById('edit-deduction-modal').style.display = 'flex';
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®ØµÙ…
        function updateDeduction() {
            const id = parseInt(document.getElementById('edit-deduction-id').value);
            const employeeId = document.getElementById('edit-deduction-employee').value;
            const type = document.getElementById('edit-deduction-type').value;
            const days = parseFloat(document.getElementById('edit-deduction-days').value);
            const date = document.getElementById('edit-deduction-date').value;
            const reason = document.getElementById('edit-deduction-reason').value;
            
            const index = deductions.findIndex(d => d.id === id);
            if (index !== -1) {
                deductions[index] = {
                    ...deductions[index],
                    employeeId,
                    type,
                    days,
                    date,
                    month: date.substring(0, 7),
                    reason
                };
                
                saveData();
                renderDeductionsTable();
                updateDashboard();
                closeEditDeductionModal();
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
                addActivity(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ ${type === 'absence' ? 'ØºÙŠØ§Ø¨' : 'Ø¬Ø²Ø§Ø¡'} Ù„Ù„Ù…ÙˆØ¸Ù`);
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®ØµÙ…
        function closeEditDeductionModal() {
            document.getElementById('edit-deduction-modal').style.display = 'none';
        }

        // Ø­Ø°Ù Ø®ØµÙ…
        function deleteDeduction(deductionId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø®ØµÙ…ØŸ')) {
                deductions = deductions.filter(d => d.id !== deductionId);
                saveData();
                renderDeductionsTable();
                updateDashboard();
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
                addActivity(`ØªÙ… Ø­Ø°Ù Ø®ØµÙ…`);
            }
        }

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª
        function filterDeductions() {
            const searchTerm = document.getElementById('deduction-search').value.toLowerCase();
            const rows = document.querySelectorAll('#deductions-table-body tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function renderWithdrawalsTable() {
            const tableBody = document.getElementById('withdrawals-table-body');
            tableBody.innerHTML = '';
            
            withdrawals.forEach(withdrawal => {
                const employee = employees.find(emp => emp.id === withdrawal.employeeId);
                const employeeName = employee ? employee.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employeeName}</td>
                    <td>${withdrawal.amount.toLocaleString()} Ø¬Ù†ÙŠÙ‡</td>
                    <td>${withdrawal.date}</td>
                    <td>${withdrawal.description}</td>
                    <td class="actions">
                        <a href="#" onclick="editWithdrawal(${withdrawal.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</a>
                        <a href="#" onclick="deleteWithdrawal(${withdrawal.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</a>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            updateWithdrawalsTotal(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function updateWithdrawalsTotal() {
            const employeeId = document.getElementById('withdrawal-search-employee').value;
            const month = document.getElementById('withdrawal-search-month').value;
            
            let filteredWithdrawals = withdrawals;
            
            if (employeeId) {
                filteredWithdrawals = filteredWithdrawals.filter(w => w.employeeId == employeeId);
            }
            
            if (month) {
                filteredWithdrawals = filteredWithdrawals.filter(w => w.month === month);
            }
            
            const total = filteredWithdrawals.reduce((sum, w) => sum + w.amount, 0);
            document.getElementById('total-withdrawal-amount').textContent = total.toLocaleString() + ' Ø¬Ù†ÙŠÙ‡';
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function addWithdrawal() {
            const employeeId = document.getElementById('withdrawal-employee').value;
            const amount = parseFloat(document.getElementById('withdrawal-amount').value);
            const date = document.getElementById('withdrawal-date').value;
            const description = document.getElementById('withdrawal-desc').value;
            
            if (!employeeId || !amount || !date) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            const withdrawal = {
                id: Date.now(),
                employeeId: parseInt(employeeId),
                amount: amount,
                date: date,
                month: date.substring(0, 7), // Ø­ÙØ¸ Ø§Ù„Ø´Ù‡Ø± Ù„Ù„ØªØµÙÙŠØ©
                description: description
            };
            
            withdrawals.push(withdrawal);
            saveData();
            renderWithdrawalsTable();
            updateDashboard();
            clearWithdrawalForm();
            
            // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
            const employee = employees.find(emp => emp.id === parseInt(employeeId));
            addActivity(`ØªØ³Ø¬ÙŠÙ„ Ù…Ø³Ø­ÙˆØ¨Ø§Øª Ù„Ù„Ù…ÙˆØ¸Ù ${employee ? employee.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`);
        }

        // Ù…Ø³Ø­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function clearWithdrawalForm() {
            document.getElementById('withdrawal-employee').value = '';
            document.getElementById('withdrawal-amount').value = '';
            document.getElementById('withdrawal-desc').value = '';
            // Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function editWithdrawal(withdrawalId) {
            const withdrawal = withdrawals.find(w => w.id === withdrawalId);
            if (!withdrawal) return;
            
            document.getElementById('edit-withdrawal-id').value = withdrawal.id;
            document.getElementById('edit-withdrawal-employee').value = withdrawal.employeeId;
            document.getElementById('edit-withdrawal-amount').value = withdrawal.amount;
            document.getElementById('edit-withdrawal-date').value = withdrawal.date;
            document.getElementById('edit-withdrawal-desc').value = withdrawal.description;
            
            // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const employeeSelect = document.getElementById('edit-withdrawal-employee');
            employeeSelect.innerHTML = '';
            employees.forEach(employee => {
                const option = document.createElement('option');
                option.value = employee.id;
                option.textContent = employee.name;
                employeeSelect.appendChild(option);
            });
            employeeSelect.value = withdrawal.employeeId;
            
            document.getElementById('edit-withdrawal-modal').style.display = 'flex';
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function updateWithdrawal() {
            const id = parseInt(document.getElementById('edit-withdrawal-id').value);
            const employeeId = document.getElementById('edit-withdrawal-employee').value;
            const amount = parseFloat(document.getElementById('edit-withdrawal-amount').value);
            const date = document.getElementById('edit-withdrawal-date').value;
            const description = document.getElementById('edit-withdrawal-desc').value;
            
            const index = withdrawals.findIndex(w => w.id === id);
            if (index !== -1) {
                withdrawals[index] = {
                    ...withdrawals[index],
                    employeeId,
                    amount,
                    date,
                    month: date.substring(0, 7),
                    description
                };
                
                saveData();
                renderWithdrawalsTable();
                updateDashboard();
                closeEditWithdrawalModal();
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
                addActivity(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³Ø­ÙˆØ¨Ø§Øª Ù„Ù„Ù…ÙˆØ¸Ù`);
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function closeEditWithdrawalModal() {
            document.getElementById('edit-withdrawal-modal').style.display = 'none';
        }

        // Ø­Ø°Ù Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function deleteWithdrawal(withdrawalId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§ØªØŸ')) {
                withdrawals = withdrawals.filter(w => w.id !== withdrawalId);
                saveData();
                renderWithdrawalsTable();
                updateDashboard();
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
                addActivity(`ØªÙ… Ø­Ø°Ù Ù…Ø³Ø­ÙˆØ¨Ø§Øª`);
            }
        }

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function searchWithdrawals() {
            const employeeId = document.getElementById('withdrawal-search-employee').value;
            const month = document.getElementById('withdrawal-search-month').value;
            
            let filteredWithdrawals = withdrawals;
            
            if (employeeId) {
                filteredWithdrawals = filteredWithdrawals.filter(w => w.employeeId == employeeId);
            }
            
            if (month) {
                filteredWithdrawals = filteredWithdrawals.filter(w => w.month === month);
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const tableBody = document.getElementById('withdrawals-table-body');
            tableBody.innerHTML = '';
            
            filteredWithdrawals.forEach(withdrawal => {
                const employee = employees.find(emp => emp.id === withdrawal.employeeId);
                const employeeName = employee ? employee.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employeeName}</td>
                    <td>${withdrawal.amount.toLocaleString()} Ø¬Ù†ÙŠÙ‡</td>
                    <td>${withdrawal.date}</td>
                    <td>${withdrawal.description}</td>
                    <td class="actions">
                        <a href="#" onclick="editWithdrawal(${withdrawal.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</a>
                        <a href="#" onclick="deleteWithdrawal(${withdrawal.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</a>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            const total = filteredWithdrawals.reduce((sum, w) => sum + w.amount, 0);
            document.getElementById('total-withdrawal-amount').textContent = total.toLocaleString() + ' Ø¬Ù†ÙŠÙ‡';
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª Ø¥Ù„Ù‰ Excel
        function exportWithdrawalsToExcel() {
            const table = document.getElementById('withdrawals-table');
            if (!table) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§');
                return;
            }
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.table_to_sheet(table);
            XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª');
            XLSX.writeFile(wb, 'Ù…Ø³Ø­ÙˆØ¨Ø§Øª_Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†.xlsx');
        }

        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
        function printWithdrawals() {
            const printContent = `
                <html>
                <head>
                    <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª</title>
                    <style>
                        body { 
                            font-family: 'Tajawal', sans-serif; 
                            direction: rtl; 
                            margin: 20px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 20px;
                        }
                        th, td {
                            padding: 10px;
                            text-align: right;
                            border: 1px solid #000;
                        }
                        th {
                            background-color: #f0f0f0;
                        }
                        h2 {
                            text-align: center;
                        }
                    </style>
                </head>
                <body>
                    <h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª</h2>
                    ${document.getElementById('withdrawals-table').outerHTML}
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ù„Ù
        function renderLoansTable() {
            const tableBody = document.getElementById('loans-table-body');
            tableBody.innerHTML = '';
            
            loans.forEach(loan => {
                const employee = employees.find(emp => emp.id === loan.employeeId);
                const employeeName = employee ? employee.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employeeName}</td>
                    <td>${loan.amount.toLocaleString()} Ø¬Ù†ÙŠÙ‡</td>
                    <td>${loan.installment.toLocaleString()} Ø¬Ù†ÙŠÙ‡</td>
                    <td>${loan.startDate}</td>
                    <td>${loan.description}</td>
                    <td class="actions">
                        <a href="#" onclick="editLoan(${loan.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</a>
                        <a href="#" onclick="deleteLoan(${loan.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</a>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø³Ù„ÙØ©
        function addLoan() {
            const employeeId = document.getElementById('loan-employee').value;
            const amount = parseFloat(document.getElementById('loan-amount').value);
            const installment = parseFloat(document.getElementById('loan-installment').value);
            const startDate = document.getElementById('loan-start-date').value;
            const description = document.getElementById('loan-desc').value;
            
            if (!employeeId || !amount || !installment || !startDate) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            const loan = {
                id: Date.now(),
                employeeId: parseInt(employeeId),
                amount: amount,
                installment: installment,
                startDate: startDate,
                description: description
            };
            
            loans.push(loan);
            saveData();
            renderLoansTable();
            clearLoanForm();
            
            // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
            const employee = employees.find(emp => emp.id === parseInt(employeeId));
            addActivity(`Ø¥Ø¶Ø§ÙØ© Ø³Ù„ÙØ© Ù„Ù„Ù…ÙˆØ¸Ù ${employee ? employee.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`);
        }

        // Ù…Ø³Ø­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø³Ù„Ù
        function clearLoanForm() {
            document.getElementById('loan-employee').value = '';
            document.getElementById('loan-amount').value = '';
            document.getElementById('loan-installment').value = '';
            document.getElementById('loan-desc').value = '';
            // Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø³Ù„ÙØ©
        function editLoan(loanId) {
            const loan = loans.find(l => l.id === loanId);
            if (!loan) return;
            
            document.getElementById('edit-loan-id').value = loan.id;
            document.getElementById('edit-loan-employee').value = loan.employeeId;
            document.getElementById('edit-loan-amount').value = loan.amount;
            document.getElementById('edit-loan-installment').value = loan.installment;
            document.getElementById('edit-loan-start-date').value = loan.startDate;
            document.getElementById('edit-loan-desc').value = loan.description;
            
            // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const employeeSelect = document.getElementById('edit-loan-employee');
            employeeSelect.innerHTML = '';
            employees.forEach(employee => {
                const option = document.createElement('option');
                option.value = employee.id;
                option.textContent = employee.name;
                employeeSelect.appendChild(option);
            });
            employeeSelect.value = loan.employeeId;
            
            document.getElementById('edit-loan-modal').style.display = 'flex';
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù„ÙØ©
        function updateLoan() {
            const id = parseInt(document.getElementById('edit-loan-id').value);
            const employeeId = document.getElementById('edit-loan-employee').value;
            const amount = parseFloat(document.getElementById('edit-loan-amount').value);
            const installment = parseFloat(document.getElementById('edit-loan-installment').value);
            const startDate = document.getElementById('edit-loan-start-date').value;
            const description = document.getElementById('edit-loan-desc').value;
            
            const index = loans.findIndex(l => l.id === id);
            if (index !== -1) {
                loans[index] = {
                    ...loans[index],
                    employeeId,
                    amount,
                    installment,
                    startDate,
                    description
                };
                
                saveData();
                renderLoansTable();
                closeEditLoanModal();
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
                addActivity(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø³Ù„ÙØ© Ù„Ù„Ù…ÙˆØ¸Ù`);
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù„Ù
        function closeEditLoanModal() {
            document.getElementById('edit-loan-modal').style.display = 'none';
        }

        // Ø­Ø°Ù Ø³Ù„ÙØ©
        function deleteLoan(loanId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù„ÙØ©ØŸ')) {
                loans = loans.filter(l => l.id !== loanId);
                saveData();
                renderLoansTable();
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
                addActivity(`ØªÙ… Ø­Ø°Ù Ø³Ù„ÙØ©`);
            }
        }

        // ØªÙˆÙ„ÙŠØ¯ ÙƒØ´Ù Ø§Ù„Ø±Ø§ØªØ¨
        function generatePayroll() {
            const employeeId = document.getElementById('payroll-employee').value;
            const month = document.getElementById('payroll-month').value;
            
            if (!month) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ù‡Ø±');
                return;
            }
            
            let targetEmployees = [];
            if (employeeId === 'all') {
                targetEmployees = employees;
            } else {
                const employee = employees.find(emp => emp.id == employeeId);
                if (employee) {
                    targetEmployees = [employee];
                }
            }
            
            if (targetEmployees.length === 0) {
                alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
                return;
            }
            
            let payrollContent = '';
            
            targetEmployees.forEach(employee => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª
                const employeeDeductions = deductions.filter(d => 
                    d.employeeId === employee.id && d.month === month
                );
                
                const totalAbsenceDays = employeeDeductions
                    .filter(d => d.type === 'absence')
                    .reduce((sum, d) => sum + d.days, 0);
                
                const totalPenaltyDays = employeeDeductions
                    .filter(d => d.type === 'penalty')
                    .reduce((sum, d) => sum + d.days, 0);
                
                // Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠØ§Ù… Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ÙØ¹Ù„ÙŠØ©)
                const monthDays = new Date(parseInt(month.substring(0, 4)), parseInt(month.substring(5, 7)) - 1, 0).getDate();
                const dailySalary = employee.salary / monthDays;
                const absenceDeduction = totalAbsenceDays * dailySalary;
                const penaltyDeduction = totalPenaltyDays * dailySalary * 0.5; // Ø®ØµÙ… 50% Ù„Ø¬Ø²Ø§Ø¡Ø§Øª
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
                const employeeWithdrawals = withdrawals.filter(w => 
                    w.employeeId === employee.id && w.month === month
                );
                
                const totalWithdrawals = employeeWithdrawals.reduce((sum, w) => sum + w.amount, 0);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ù„Ù (ÙÙ‚Ø· Ø§Ù„Ø³Ù„Ù Ø§Ù„Ù†Ø´Ø·Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±)
                let totalLoanDeduction = 0;
                const currentMonthDate = new Date(month + '-01');
                
                loans.forEach(loan => {
                    if (loan.employeeId === employee.id) {
                        const loanStartDate = new Date(loan.startDate);
                        // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù‚Ø±Ø¶ Ù†Ø´Ø· ÙÙŠ Ø´Ù‡Ø± ÙƒØ´Ù Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
                        if (loanStartDate <= currentMonthDate) {
                            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¶
                            const monthsPaid = Math.floor((currentMonthDate - loanStartDate) / (30.44 * 24 * 60 * 60 * 1000));
                            const paidAmount = monthsPaid * loan.installment;
                            const remainingAmount = loan.amount - paidAmount;
                            
                            // Ø®ØµÙ… Ø§Ù„Ù‚Ø³Ø· ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø¨Ù„Øº Ù…ØªØ¨Ù‚ÙŠ
                            if (remainingAmount > 0) {
                                totalLoanDeduction += Math.min(loan.installment, remainingAmount);
                            }
                        }
                    }
                });
                
                // Ø­Ø³Ø§Ø¨ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©
                let welfareFundDeduction = 0;
                if (employee.welfareFundConsent === 'Ù†Ø¹Ù…') {
                    welfareFundDeduction = welfareFundAmount;
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª (ØªØºÙŠÙŠØ± Ù†Ø³Ø¨Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„ Ø¥Ù„Ù‰ 18.75%)
                const insuranceEmployee = employee.insuranceSalary * 0.11; // 11% Ù…Ù† Ù…ÙˆØ¸Ù
                const insuranceEmployer = employee.insuranceSalary * 0.1875; // 18.75% Ù…Ù† Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ
                const totalDeductions = absenceDeduction + penaltyDeduction + totalWithdrawals + totalLoanDeduction + welfareFundDeduction + insuranceEmployee;
                const netSalary = employee.salary - totalDeductions;
                
                // ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ Ø³Ø§Ù„Ø¨Ù‹Ø§
                let salaryAlert = '';
                if (netSalary < 0) {
                    salaryAlert = `<div class="salary-alert">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ Ø³Ø§Ù„Ø¨! (${Math.abs(netSalary).toLocaleString()} Ø¬Ù†ÙŠÙ‡ Ø®ØµÙ… Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ø±Ø§ØªØ¨)</div>`;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ´Ù Ø§Ù„Ø±Ø§ØªØ¨
                payrollContent += `
                <div class="payslip">
                    ${salaryAlert}
                    <div class="payslip-header">
                        <h2>ÙƒØ´Ù Ø±Ø§ØªØ¨</h2>
                        <p>Ø§Ù„Ø´Ù‡Ø±: ${month}</p>
                    </div>
                    
                    <div class="payslip-details">
                        <div>
                            <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</strong> ${employee.name}</p>
                            <p><strong>Ø§Ù„ÙˆØ¸ÙŠÙØ©:</strong> ${employee.jobTitle}</p>
                            <p><strong>Ø§Ù„Ù‚Ø³Ù…:</strong> ${employee.department}</p>
                        </div>
                        <div>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</strong> ${employee.hireDate}</p>
                            <p><strong>Ø±Ù‚Ù… Ø§Ù„ØªØ£Ù…ÙŠÙ†:</strong> ${employee.insuranceNumber}</p>
                        </div>
                    </div>
                    
                    <div class="payslip-details">
                        <div>
                            <div class="payslip-row">
                                <span>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</span>
                                <span>${employee.salary.toLocaleString()} Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                            <div class="payslip-row">
                                <span>Ø±Ø§ØªØ¨ Ø§Ù„ØªØ£Ù…ÙŠÙ†:</span>
                                <span>${employee.insuranceSalary.toLocaleString()} Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                        </div>
                        <div>
                            <!-- ÙØ±Ø§Øº Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ -->
                        </div>
                    </div>
                    
                    <h3>Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</h3>
                    <div class="payslip-details">
                        <div>
                            <div class="payslip-row">
                                <span>ØºÙŠØ§Ø¨Ø§Øª (${totalAbsenceDays} ÙŠÙˆÙ…):</span>
                                <span>${absenceDeduction.toLocaleString()} Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                            <div class="payslip-row">
                                <span>Ø¬Ø²Ø§Ø¡Ø§Øª (${totalPenaltyDays} ÙŠÙˆÙ…):</span>
                                <span>${penaltyDeduction.toLocaleString()} Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                            <div class="payslip-row">
                                <span>Ù…Ø³Ø­ÙˆØ¨Ø§Øª:</span>
                                <span>${totalWithdrawals.toLocaleString()} Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                        </div>
                        <div>
                            <div class="payslip-row">
                                <span>Ø³Ù„Ù:</span>
                                <span>${totalLoanDeduction.toLocaleString()} Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                            <div class="payslip-row">
                                <span>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©:</span>
                                <span>${welfareFundDeduction.toLocaleString()} Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                            <div class="payslip-row">
                                <span>ØªØ£Ù…ÙŠÙ† Ù…ÙˆØ¸Ù (11%):</span>
                                <span>${insuranceEmployee.toLocaleString()} Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="payslip-row payslip-total">
                        <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª:</strong>
                        <strong>${totalDeductions.toLocaleString()} Ø¬Ù†ÙŠÙ‡</strong>
                    </div>
                    
                    <div class="payslip-row payslip-total">
                        <strong>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ:</strong>
                        <strong>${netSalary.toLocaleString()} Ø¬Ù†ÙŠÙ‡</strong>
                    </div>
                    
                    <div class="signature-section">
                        <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸Ù: ...................</div>
                        <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨: ...................</div>
                    </div>
                </div>
                <div style="page-break-after: always;"></div>
                `;
            });
            
            document.getElementById('payroll-container').innerHTML = payrollContent;
            document.getElementById('payroll-container').style.display = 'block';
        }

        // Ø·Ø¨Ø§Ø¹Ø© ÙƒØ´Ù Ø§Ù„Ø±ÙˆØ§ØªØ¨
        function printPayroll() {
            const payrollContent = document.getElementById('payroll-container');
            if (!payrollContent || payrollContent.style.display === 'none') {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒØ´Ù Ø±Ø§ØªØ¨ Ù„Ø·Ø¨Ø§Ø¹ØªÙ‡');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>ÙƒØ´Ù Ø§Ù„Ø±ÙˆØ§ØªØ¨</title>
                    <style>
                        body { 
                            font-family: 'Tajawal', sans-serif; 
                            direction: rtl; 
                        }
                        .payslip { 
                            max-width: 800px; 
                            margin: 20px auto; 
                            padding: 30px; 
                            border: 1px solid #ccc; 
                        }
                        .payslip-header {
                            text-align: center;
                            margin-bottom: 30px;
                        }
                        .payslip-details {
                            display: grid;
                            grid-template-columns: repeat(2, 1fr);
                            gap: 15px;
                            margin-bottom: 30px;
                        }
                        .payslip-row {
                            display: flex;
                            justify-content: space-between;
                            padding: 8px 0;
                            border-bottom: 1px dashed #ddd;
                        }
                        .payslip-total {
                            font-weight: bold;
                            font-size: 1.1rem;
                            margin-top: 10px;
                        }
                        .signature-section {
                            margin-top: 40px;
                            display: flex;
                            justify-content: space-between;
                        }
                        .salary-alert {
                            background-color: #fff3cd;
                            border: 1px solid #ffeaa7;
                            color: #856404;
                            padding: 10px;
                            border-radius: 5px;
                            margin-bottom: 15px;
                            font-weight: bold;
                        }
                    </style>
                </head>
                <body>
                    ${payrollContent.innerHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ±
        function generateReport() {
            const reportType = document.getElementById('report-type').value;
            const month = document.getElementById('report-month').value;
            const department = document.getElementById('report-department').value;
            
            if (!month) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ù‡Ø±');
                return;
            }
            
            let title = '';
            let content = '';
            
            if (reportType === 'payroll') {
                title = `ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ù„Ø´Ù‡Ø± ${month}`;
                content = generatePayrollReport(month, department);
            } else if (reportType === 'absences') {
                title = `ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª Ù„Ø´Ù‡Ø± ${month}`;
                content = generateAbsencesReport(month, department);
            } else if (reportType === 'penalties') {
                title = `ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª Ù„Ø´Ù‡Ø± ${month}`;
                content = generatePenaltiesReport(month, department);
            } else if (reportType === 'insurance') {
                title = `ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ù„Ø´Ù‡Ø± ${month}`;
                content = generateInsuranceReport(month, department);
            } else if (reportType === 'welfareFund') {
                title = `ØªÙ‚Ø±ÙŠØ± ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø© Ù„Ø´Ù‡Ø± ${month}`;
                content = generateWelfareFundReport(month, department);
            }
            
            document.getElementById('report-title').textContent = title;
            document.getElementById('report-content').innerHTML = content;
            document.getElementById('report-output').style.display = 'block';
        }

        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±ÙˆØ§ØªØ¨
        function generatePayrollReport(month, department) {
            let filteredEmployees = employees;
            if (department !== 'all') {
                filteredEmployees = employees.filter(emp => emp.department === department);
            }
            
            let reportContent = `
                <table>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th>
                        <th>Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª</th>
                        <th>Ù‚ÙŠÙ…Ø© Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª</th>
                        <th>Ø§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª</th>
                        <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª</th>
                        <th>Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª</th>
                        <th>Ø§Ù„Ø³Ù„Ù</th>
                        <th>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©</th>
                        <th>ØªØ£Ù…ÙŠÙ† Ù…ÙˆØ¸Ù</th>
                        <th>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ</th>
                    </tr>
            `;
            
            let totalSalary = 0;
            let totalAbsenceDeduction = 0;
            let totalPenaltyDeduction = 0;
            let totalWithdrawals = 0;
            let totalLoans = 0;
            let totalWelfareFund = 0;
            let totalInsurance = 0;
            let totalNetSalary = 0;
            
            filteredEmployees.forEach(employee => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª
                const employeeDeductions = deductions.filter(d => 
                    d.employeeId === employee.id && d.month === month
                );
                
                const totalAbsenceDays = employeeDeductions
                    .filter(d => d.type === 'absence')
                    .reduce((sum, d) => sum + d.days, 0);
                
                const totalPenaltyDays = employeeDeductions
                    .filter(d => d.type === 'penalty')
                    .reduce((sum, d) => sum + d.days, 0);
                
                // Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
                const dailySalary = employee.salary / 30;
                const absenceDeduction = totalAbsenceDays * dailySalary;
                const penaltyDeduction = totalPenaltyDays * dailySalary * 0.5;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª
                const employeeWithdrawals = withdrawals.filter(w => 
                    w.employeeId === employee.id && w.month === month
                );
                
                const totalWithdrawalAmount = employeeWithdrawals.reduce((sum, w) => sum + w.amount, 0);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ù„Ù
                const employeeLoans = loans.filter(l => l.employeeId === employee.id);
                let totalLoanAmount = 0;
                
                employeeLoans.forEach(loan => {
                    totalLoanAmount += loan.installment;
                });
                
                // Ø­Ø³Ø§Ø¨ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©
                let welfareFundAmount = 0;
                if (employee.welfareFundConsent === 'Ù†Ø¹Ù…') {
                    welfareFundAmount = welfareFundAmount;
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª (ØªØºÙŠÙŠØ± Ù†Ø³Ø¨Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„ Ø¥Ù„Ù‰ 18.75%)
                const insuranceEmployee = employee.insuranceSalary * 0.11;
                const insuranceEmployer = employee.insuranceSalary * 0.1875;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ
                const totalDeductions = absenceDeduction + penaltyDeduction + totalWithdrawalAmount + totalLoanAmount + welfareFundAmount + insuranceEmployee;
                const netSalary = employee.salary - totalDeductions;
                
                reportContent += `
                    <tr>
                        <td>${employee.name}</td>
                        <td>${employee.salary.toLocaleString()}</td>
                        <td>${totalAbsenceDays}</td>
                        <td>${absenceDeduction.toLocaleString()}</td>
                        <td>${totalPenaltyDays}</td>
                        <td>${penaltyDeduction.toLocaleString()}</td>
                        <td>${totalWithdrawalAmount.toLocaleString()}</td>
                        <td>${totalLoanAmount.toLocaleString()}</td>
                        <td>${welfareFundAmount.toLocaleString()}</td>
                        <td>${insuranceEmployee.toLocaleString()}</td>
                        <td>${netSalary.toLocaleString()}</td>
                    </tr>
                `;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹
                totalSalary += employee.salary;
                totalAbsenceDeduction += absenceDeduction;
                totalPenaltyDeduction += penaltyDeduction;
                totalWithdrawals += totalWithdrawalAmount;
                totalLoans += totalLoanAmount;
                totalWelfareFund += welfareFundAmount;
                totalInsurance += insuranceEmployee;
                totalNetSalary += netSalary;
            });
            
            reportContent += `
                    <tr style="background-color: #f0f0f0; font-weight: bold;">
                        <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                        <td>${totalSalary.toLocaleString()}</td>
                        <td></td>
                        <td>${totalAbsenceDeduction.toLocaleString()}</td>
                        <td></td>
                        <td>${totalPenaltyDeduction.toLocaleString()}</td>
                        <td>${totalWithdrawals.toLocaleString()}</td>
                        <td>${totalLoans.toLocaleString()}</td>
                        <td>${totalWelfareFund.toLocaleString()}</td>
                        <td>${totalInsurance.toLocaleString()}</td>
                        <td>${totalNetSalary.toLocaleString()}</td>
                    </tr>
                </table>
            `;
            
            return reportContent;
        }

        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª
        function generateAbsencesReport(month, department) {
            let filteredEmployees = employees;
            if (department !== 'all') {
                filteredEmployees = employees.filter(emp => emp.department === department);
            }
            
            // ØªØµÙÙŠØ© Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª Ù„Ø´Ù‡Ø± Ù…Ø¹ÙŠÙ†
            const monthAbsences = deductions.filter(d => 
                d.type === 'absence' && d.month === month
            );
            
            let reportContent = `
                <table>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨</th>
                        <th>Ù‚ÙŠÙ…Ø© Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø³Ø¨Ø¨</th>
                    </tr>
            `;
            
            let totalAbsenceDays = 0;
            let totalAbsenceValue = 0;
            
            monthAbsences.forEach(absence => {
                const employee = filteredEmployees.find(emp => emp.id === absence.employeeId);
                if (employee) {
                    const absenceValue = (employee.salary / 30) * absence.days;
                    
                    reportContent += `
                        <tr>
                            <td>${employee.name}</td>
                            <td>${absence.days}</td>
                            <td>${absenceValue.toLocaleString()}</td>
                            <td>${absence.date}</td>
                            <td>${absence.reason}</td>
                        </tr>
                    `;
                    
                    totalAbsenceDays += absence.days;
                    totalAbsenceValue += absenceValue;
                }
            });
            
            reportContent += `
                    <tr style="background-color: #f0f0f0; font-weight: bold;">
                        <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                        <td>${totalAbsenceDays}</td>
                        <td>${totalAbsenceValue.toLocaleString()}</td>
                        <td colspan="2"></td>
                    </tr>
                </table>
            `;
            
            return reportContent;
        }

        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª
        function generatePenaltiesReport(month, department) {
            let filteredEmployees = employees;
            if (department !== 'all') {
                filteredEmployees = employees.filter(emp => emp.department === department);
            }
            
            // ØªØµÙÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª Ù„Ø´Ù‡Ø± Ù…Ø¹ÙŠÙ†
            const monthPenalties = deductions.filter(d => 
                d.type === 'penalty' && d.month === month
            );
            
            let reportContent = `
                <table>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¬Ø²Ø§Ø¡</th>
                        <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø³Ø¨Ø¨</th>
                    </tr>
            `;
            
            let totalPenaltyDays = 0;
            let totalPenaltyValue = 0;
            
            monthPenalties.forEach(penalty => {
                const employee = filteredEmployees.find(emp => emp.id === penalty.employeeId);
                if (employee) {
                    // Ø®ØµÙ… 50% Ù…Ù† Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø¬Ø²Ø§Ø¡Ø§Øª
                    const penaltyValue = (employee.salary / 30) * penalty.days * 0.5;
                    
                    reportContent += `
                        <tr>
                            <td>${employee.name}</td>
                            <td>${penalty.days}</td>
                            <td>${penaltyValue.toLocaleString()}</td>
                            <td>${penalty.date}</td>
                            <td>${penalty.reason}</td>
                        </tr>
                    `;
                    
                    totalPenaltyDays += penalty.days;
                    totalPenaltyValue += penaltyValue;
                }
            });
            
            reportContent += `
                    <tr style="background-color: #f0f0f0; font-weight: bold;">
                        <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                        <td>${totalPenaltyDays}</td>
                        <td>${totalPenaltyValue.toLocaleString()}</td>
                        <td colspan="2"></td>
                    </tr>
                </table>
            `;
            
            return reportContent;
        }

        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª
        function generateInsuranceReport(month, department) {
            let filteredEmployees = employees;
            if (department !== 'all') {
                filteredEmployees = employees.filter(emp => emp.department === department);
            }
            
            let reportContent = `
                <table>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th>Ø±Ø§ØªØ¨ Ø§Ù„ØªØ£Ù…ÙŠÙ†</th>
                        <th>ØªØ£Ù…ÙŠÙ† Ù…ÙˆØ¸Ù (11%)</th>
                        <th>ØªØ£Ù…ÙŠÙ† Ø¬Ù‡Ø© Ø¹Ù…Ù„ (18.75%)</th>
                        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ†</th>
                    </tr>
            `;
            
            let totalInsuranceSalary = 0;
            let totalEmployeeInsurance = 0;
            let totalEmployerInsurance = 0;
            let totalInsurance = 0;
            
            filteredEmployees.forEach(employee => {
                // ØªØºÙŠÙŠØ± Ù†Ø³Ø¨Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„ Ø¥Ù„Ù‰ 18.75%
                const insuranceEmployee = employee.insuranceSalary * 0.11;
                const insuranceEmployer = employee.insuranceSalary * 0.1875;
                const totalInsuranceAmount = insuranceEmployee + insuranceEmployer;
                
                reportContent += `
                    <tr>
                        <td>${employee.name}</td>
                        <td>${employee.insuranceSalary.toLocaleString()}</td>
                        <td>${insuranceEmployee.toLocaleString()}</td>
                        <td>${insuranceEmployer.toLocaleString()}</td>
                        <td>${totalInsuranceAmount.toLocaleString()}</td>
                    </tr>
                `;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹
                totalInsuranceSalary += employee.insuranceSalary;
                totalEmployeeInsurance += insuranceEmployee;
                totalEmployerInsurance += insuranceEmployer;
                totalInsurance += totalInsuranceAmount;
            });
            
            reportContent += `
                    <tr style="background-color: #f0f0f0; font-weight: bold;">
                        <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                        <td>${totalInsuranceSalary.toLocaleString()}</td>
                        <td>${totalEmployeeInsurance.toLocaleString()}</td>
                        <td>${totalEmployerInsurance.toLocaleString()}</td>
                        <td>${totalInsurance.toLocaleString()}</td>
                    </tr>
                </table>
            `;
            
            return reportContent;
        }

        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©
        function generateWelfareFundReport(month, department) {
            let filteredEmployees = employees;
            if (department !== 'all') {
                filteredEmployees = employees.filter(emp => emp.department === department);
            }
            
            // ØªØµÙÙŠØ© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø°ÙŠÙ† ÙˆØ§ÙÙ‚ÙˆØ§ Ø¹Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²Ù…Ø§Ù„Ø©
            const welfareFundEmployees = filteredEmployees.filter(emp => emp.welfareFundConsent === 'Ù†Ø¹Ù…');
            
            let reportContent = `
                <table>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                    </tr>
            `;
            
            let totalWelfareFund = 0;
            
            welfareFundEmployees.forEach(employee => {
                reportContent += `
                    <tr>
                        <td>${employee.name}</td>
                        <td>${welfareFundAmount.toLocaleString()}</td>
                    </tr>
                `;
                
                totalWelfareFund += welfareFundAmount;
            });
            
            reportContent += `
                    <tr style="background-color: #f0f0f0; font-weight: bold;">
                        <td>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†: ${welfareFundEmployees.length}</td>
                        <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalWelfareFund.toLocaleString()}</td>
                    </tr>
                </table>
            `;
            
            return reportContent;
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ PDF
        function exportReportToPDF() {
            const reportOutput = document.getElementById('report-output');
            if (!reportOutput || reportOutput.style.display === 'none') {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø±ÙŠØ± Ù„ØªØµØ¯ÙŠØ±Ù‡');
                return;
            }
            
            const element = reportOutput.cloneNode(true);
            element.style.display = 'block';
            
            const options = {
                margin: 10,
                filename: 'ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù†Ø¸Ø§Ù….pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().from(element).set(options).save();
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Excel
        function exportReportToExcel() {
            const reportOutput = document.getElementById('report-output');
            if (!reportOutput || reportOutput.style.display === 'none') {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø±ÙŠØ± Ù„ØªØµØ¯ÙŠØ±Ù‡');
                return;
            }
            
            const table = reportOutput.querySelector('table');
            if (!table) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ø¯ÙˆÙ„ ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„ØªØµØ¯ÙŠØ±Ù‡');
                return;
            }
            
            const wb = XLSX.utils.table_to_book(table, { sheet: "ØªÙ‚Ø±ÙŠØ±" });
            XLSX.writeFile(wb, 'ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù†Ø¸Ø§Ù….xlsx');
        }

        // ØªØºÙŠÙŠØ± Ø³Ù…Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
        function changeTheme(color) {
            // ØªØ­Ø¯ÙŠØ« Ø£Ù„ÙˆØ§Ù† CSS Ø§Ù„Ù…ØªØºÙŠØ±Ø©
            document.documentElement.style.setProperty('--primary', color);
            
            // ØªØ¸Ù„ÙŠÙ„ Ø£ØºÙ…Ù‚ Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
            const darkerColor = shadeColor(color, -20);
            document.documentElement.style.setProperty('--primary-dark', darkerColor);
            
            // ØªØ¸Ù„ÙŠÙ„ Ø£ÙØªØ­ Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
            const lighterColor = shadeColor(color, 80);
            document.documentElement.style.setProperty('--primary-light', lighterColor);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ø´Ø·Ø©
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Ø­ÙØ¸ Ø§Ù„Ø³Ù…Ø© ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            localStorage.setItem('themeColor', color);
        }

        // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†
        function shadeColor(color, percent) {
            let R = parseInt(color.substring(1, 3), 16);
            let G = parseInt(color.substring(3, 5), 16);
            let B = parseInt(color.substring(5, 7), 16);
            
            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);
            
            R = (R < 255) ? R : 255;
            G = (G < 255) ? G : 255;
            B = (B < 255) ? B : 255;
            
            R = Math.round(R);
            G = Math.round(G);
            B = Math.round(B);
            
            const RR = ((R.toString(16).length == 1) ? "0" + R.toString(16) : R.toString(16));
            const GG = ((G.toString(16).length == 1) ? "0" + G.toString(16) : G.toString(16));
            const BB = ((B.toString(16).length == 1) ? "0" + B.toString(16) : B.toString(16));
            
            return "#" + RR + GG + BB;
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = initApp;
    </script>
</body>
</html>
